{"remainingRequest":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/chenyang/Documents/jeecg-boot/前端代码/src/views/user/Step2.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/src/views/user/Step2.vue","mtime":1596297340402},{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {postAction} from '@/api/manage'\n\nexport default {\n  name: \"Step2\",\n  props: ['userList'],\n  data() {\n    return {\n      form: this.$form.createForm(this),\n      loading: false,\n      // accountName: this.userList.username,\n      dropList: \"0\",\n      captcha: \"\",\n      show: true,\n      state: {\n        time: 60,\n        smsSendBtn: false,\n      },\n      formLogin: {\n        captcha: \"\",\n        mobile: \"\",\n      },\n      validatorRules: {\n        captcha: {rule: [{required: true, message: '请输入短信验证码!'}, {validator: this.validateCaptcha}]},\n        phone: {rule: [{required: true, message: '请输入手机号码!'}, {validator: this.validatePhone}]},\n      },\n    }\n  },\n  computed: {\n  },\n  methods: {\n    nextStep() {\n      let that = this\n      that.loading = true\n      this.form.validateFields((err, values) => {\n        console.log(values);\n        if (!err) {\n          if (that.dropList == \"0\") {\n            if (values.captcha == undefined) {\n              this.cmsFailed(\"请输入短信验证码!\");\n            } else {\n              var params = {}\n              params.phone = values.phone;\n              params.smscode = values.captcha;\n              postAction(\"/sys/user/phoneVerification\", params).then((res) => {\n                if (res.success) {\n                  console.log(res);\n                  var userList = {\n                    username: res.result.username,\n                    phone: values.phone,\n                    smscode: res.result.smscode\n                  };\n                  setTimeout(function () {\n                    that.$emit('nextStep', userList)\n                  }, 0)\n                } else {\n                  this.cmsFailed(res.message);\n                }\n              })\n\n            }\n          }\n\n\n        }\n      })\n    },\n    getCaptcha(e) {\n      e.preventDefault();\n      let that = this;\n      let phone=that.form.getFieldValue(\"phone\")\n      if(!phone){\n        this.cmsFailed(\"手机号不能为空!\");\n        return;\n      }\n      this.state.smsSendBtn = true;\n      let interval = window.setInterval(() => {\n        if (that.state.time-- <= 0) {\n          that.state.time = 60;\n          that.state.smsSendBtn = false;\n          window.clearInterval(interval);\n        }\n      }, 1000);\n\n      const hide = this.$message.loading('验证码发送中..', 0);\n      let smsParams = {\n        mobile: phone,\n        smsmode: \"2\"\n      };\n      postAction(\"/sys/sms\", smsParams).then(res => {\n        if (!res.success) {\n          setTimeout(hide, 1);\n          this.cmsFailed(res.message);\n        }\n        setTimeout(hide, 500);\n      })\n    },\n    cmsFailed(err) {\n      this.$notification['error']({\n        message: \"验证错误\",\n        description: err,\n        duration: 4,\n      });\n    },\n    handleChangeSelect(value) {\n      var that = this;\n      console.log(value);\n      if (value == 0) {\n        that.dropList = \"0\";\n        that.show = true;\n      } else {\n        that.dropList = \"1\";\n        that.show = false;\n      }\n    },\n    validatePhone(rule,value,callback){\n        if(value){\n          var myreg=/^[1][3,4,5,7,8][0-9]{9}$/;\n          if(!myreg.test(value)){\n            callback(\"请输入正确的手机号\")\n          }else{\n            callback();\n          }\n        }else{\n          callback()\n        }\n    }\n  }\n\n}\n",null]}