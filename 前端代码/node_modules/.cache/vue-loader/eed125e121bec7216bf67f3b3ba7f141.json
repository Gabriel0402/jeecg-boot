{"remainingRequest":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/chenyang/Documents/jeecg-boot/前端代码/src/views/pipe/PipeInfoList.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/src/views/pipe/PipeInfoList.vue","mtime":1596297333612},{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport '@/assets/less/TableExpand.less'\nimport { mixinDevice } from '@/utils/mixin'\nimport { JeecgListMixin } from '@/mixins/JeecgListMixin'\nimport PipeInfoModal from './modules/PipeInfoModal'\nimport { ACCESS_TOKEN } from \"@/store/mutation-types\"\nimport { getAction } from '@/api/manage'\nimport Vue from 'vue'\nimport { filterObj } from '@/utils/util';\nimport { FormTypes,getRefPromise } from '@/utils/JEditableTableUtil'\n\nexport default {\n  name: \"PipeInfoList\",\n  mixins:[mixinDevice],\n  components: {\n    PipeInfoModal\n  },\n  data () {\n    return {\n      description: '节点信息管理页面',\n      // 表头\n      zoom: 18,\n      center: [119.953, 31.688],\n      lines:[],\n      markers: [],\n      url: {\n        list: \"/pipeinfo/pipeInfo/list\",\n        slist:'/pipeinfo/pipeInfo/querySensorLocInfoByMainId'\n      },\n      dictOptions:{},\n      // data related\n      superQueryParams: '',\n      /** 高级查询拼接方式 */\n      superQueryMatchType: 'and',\n      tokenHeader: {'X-Access-Token': Vue.ls.get(ACCESS_TOKEN)},\n      /* 查询条件-请不要在queryParam中声明非字符串值的属性 */\n      queryParam: {},\n      /* 数据源 */\n      dataSource:[],\n      /* 分页参数 */\n      ipagination:{\n        current: 1,\n        pageSize: 10,\n        pageSizeOptions: ['10', '20', '30'],\n        showTotal: (total, range) => {\n          return range[0] + \"-\" + range[1] + \" 共\" + total + \"条\"\n        },\n        showQuickJumper: true,\n        showSizeChanger: true,\n        total: 0\n      },\n      columns: [\n        {\n          title: '#',\n          dataIndex: '',\n          key:'rowIndex',\n          width:60,\n          align:\"center\",\n          customRender:function (t,r,index) {\n            return parseInt(index)+1;\n          }\n        },\n        {\n          title:'管道设备ID',\n          align:\"center\",\n          dataIndex: 'pipeId'\n        },\n        {\n          title:'管道描述',\n          align:\"center\",\n          dataIndex: 'pipeDes'\n        },\n        {\n          title:'首纬度',\n          align:\"center\",\n          dataIndex: 'hlat'\n        },\n        {\n          title:'首经度',\n          align:\"center\",\n          dataIndex: 'hlong'\n        },\n        {\n          title:'尾纬度',\n          align:\"center\",\n          dataIndex: 'rlat'\n        },\n        {\n          title:'尾经度',\n          align:\"center\",\n          dataIndex: 'rlong'\n        },\n        {\n          title: '操作',\n          dataIndex: 'action',\n          align:\"center\",\n          scopedSlots: { customRender: 'action' },\n        }\n      ],\n      sensorLocInfoTable: {\n        loading: false,\n        dataSource: [],\n        columns: [\n          {\n            title: '设备号',\n            key: 'uid',\n            type: FormTypes.input,\n            width:\"200px\",\n            placeholder: '请输入${title}',\n            defaultValue: '',\n          },\n          {\n            title: '创建人',\n            key: 'createBy',\n            type: FormTypes.input,\n            width:\"200px\",\n            placeholder: '请输入${title}',\n            defaultValue: '',\n          },\n          {\n            title: '纬度',\n            key: 'latitude',\n            type: FormTypes.input,\n            width:\"200px\",\n            placeholder: '请输入${title}',\n            defaultValue: '',\n          },\n          {\n            title: '经度',\n            key: 'longitude',\n            type: FormTypes.input,\n            width:\"200px\",\n            placeholder: '请输入${title}',\n            defaultValue: '',\n          },\n          // {\n          //   title: '所属管道',\n          //   key: 'pipeId',\n          //   type: FormTypes.input,\n          //   width:\"200px\",\n          //   placeholder: '请输入${title}',\n          //   defaultValue: '',\n          // },\n          {\n            title: '节点描述',\n            key: 'desp',\n            type: FormTypes.input,\n            width:\"200px\",\n            placeholder: '请输入${title}',\n            defaultValue: '',\n          },\n        ]\n      },\n    }\n  },\n  computed: {\n    importExcelUrl: function(){\n      return `${window._CONFIG['domianURL']}/${this.url.importExcelUrl}`;\n    },\n  },\n  created() {\n    this.loadData();\n  },\n  methods: {\n    loadData(arg){\n      if(!this.url.list){\n        this.$message.error(\"请设置url.list属性!\")\n        return\n      }\n      //加载数据 若传入参数1则加载第一页的内容\n      if (arg === 1) {\n        this.ipagination.current = 1;\n      }\n      var params = this.getQueryParams();\n      this.loading = true;\n      getAction(this.url.list, params).then((res) => {\n        if (res.success) {\n          this.dataSource = res.result.records;\n          let ids=this.dataSource.map((item)=>{\n            return item.id;\n          })\n          // this.markers= \n          this.lines = this.dataSource.map((item)=>{\n            return [[item.hlong,item.hlat],[item.rlong,item.rlat]]\n          })\n          for (let id of ids) {\n            let params = { id: id }\n            getAction(this.url.slist,params).then(res=>{\n              let { result } = res\n              let dataSource = []\n              if (result) {\n                if (Array.isArray(result)) {\n                  dataSource = result\n                } else if (Array.isArray(result.records)) {\n                  dataSource = result.records\n                }\n              }\n              dataSource.forEach((item)=>{\n                let marker = {\n                  position: [item.longitude, item.latitude],\n                  id:item.id\n                };\n                this.markers.push(marker);\n              })\n            \n            })\n          }\n          this.ipagination.total = res.result.total;\n        }\n        if(res.code===510){\n          this.$message.warning(res.message)\n        }\n        this.loading = false;\n      })\n    },\n    getQueryParams() {\n    //获取查询条件\n      let sqp = {}\n      if(this.superQueryParams){\n        sqp['superQueryParams']=encodeURI(this.superQueryParams)\n        sqp['superQueryMatchType'] = this.superQueryMatchType\n      }\n      var param = Object.assign(sqp, this.queryParam, this.isorter ,this.filters);\n      param.field = this.getQueryField();\n      param.pageNo = this.ipagination.current;\n      param.pageSize = this.ipagination.pageSize;\n      return filterObj(param);\n    },\n    getQueryField() {\n      //TODO 字段权限控制\n      var str = \"id,\";\n      this.columns.forEach(function (value) {\n        str += \",\" + value.dataIndex;\n      });\n      return str;\n    }\n  }\n}\n",null]}