{"remainingRequest":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/thread-loader/dist/cjs.js!/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/chenyang/Documents/jeecg-boot/前端代码/src/views/user/LoginSelectModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/src/views/user/LoginSelectModal.vue","mtime":1596300530785},{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chenyang/Documents/jeecg-boot/前端代码/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Vue from 'vue';\nimport { getAction, putAction } from '@/api/manage';\nimport { USER_INFO } from \"@/store/mutation-types\";\nimport store from './Login';\nexport default {\n  name: 'LoginSelectModal',\n  data: function data() {\n    return {\n      visible: false,\n      isMultiDepart: false,\n      departList: [],\n      isMultiTenant: false,\n      tenantList: [],\n      username: '',\n      orgCode: '',\n      tenant_id: '',\n      validate_status1: \"\",\n      validate_status2: \"\"\n    };\n  },\n  computed: {\n    title: function title() {\n      if (this.isMultiDepart && this.isMultiTenant) {\n        return '请选择租户和部门';\n      } else if (this.isMultiDepart && !this.isMultiTenant) {\n        return '请选择部门';\n      } else if (!this.isMultiDepart && this.isMultiTenant) {\n        return '请选择租户';\n      }\n    }\n  },\n  methods: {\n    clear: function clear() {\n      this.departList = [];\n      this.tenantList = [];\n      this.visible = false;\n      this.validate_status1 = '';\n      this.validate_status2 = '';\n    },\n    bizDepart: function bizDepart(loginResult) {\n      var multi_depart = loginResult.multi_depart; //0:无部门 1:一个部门 2:多个部门\n\n      if (multi_depart == 0) {\n        // this.$notification.warn({\n        //   message: '提示',\n        //   description: `您尚未归属部门,请确认账号信息`,\n        //   duration:3\n        // });\n        this.isMultiDepart = false;\n      } else if (multi_depart == 2) {\n        this.visible = true;\n        this.isMultiDepart = true;\n        this.departList = loginResult.departs;\n      } else {\n        this.isMultiDepart = false;\n      }\n    },\n    bizTenant: function bizTenant(ids) {\n      var _this = this;\n\n      if (!ids || ids.length == 0) {\n        this.isMultiTenant = false;\n      } else if (ids.indexOf(',') < 0) {\n        this.tenant_id = ids;\n        this.isMultiTenant = false;\n      } else {\n        this.visible = true;\n        this.isMultiTenant = true;\n        getAction('/sys/tenant/queryList', {\n          ids: ids\n        }).then(function (res) {\n          _this.tenantList = res.result;\n        });\n      }\n    },\n    show: function show(loginResult) {\n      this.clear();\n      this.bizDepart(loginResult);\n      var user = Vue.ls.get(USER_INFO);\n      this.username = user.username;\n      var ids = user.relTenantIds;\n      this.bizTenant(ids);\n\n      if (this.visible === false) {\n        this.$store.dispatch('saveTenant', this.tenant_id);\n        this.$emit('success');\n      }\n    },\n    requestFailed: function requestFailed(err) {\n      this.$notification['error']({\n        message: '登录失败',\n        description: ((err.response || {}).data || {}).message || err.message || \"请求出现错误，请稍后再试\",\n        duration: 4\n      });\n      this.loginBtn = false;\n    },\n    departResolve: function departResolve() {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        if (_this2.isMultiDepart === false) {\n          resolve();\n        } else {\n          var obj = {\n            orgCode: _this2.orgCode,\n            username: _this2.username\n          };\n          putAction(\"/sys/selectDepart\", obj).then(function (res) {\n            if (res.success) {\n              var userInfo = res.result.userInfo;\n              Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000);\n\n              _this2.$store.commit('SET_INFO', userInfo); //console.log(\"---切换组织机构---userInfo-------\",store.getters.userInfo.orgCode);\n\n\n              resolve();\n            } else {\n              _this2.requestFailed(res);\n\n              _this2.$store.dispatch('Logout');\n\n              reject();\n            }\n          });\n        }\n      });\n    },\n    selectOk: function selectOk() {\n      var _this3 = this;\n\n      if (this.isMultiTenant && !this.tenant_id) {\n        this.validate_status1 = 'error';\n        return false;\n      }\n\n      if (this.isMultiDepart && !this.orgCode) {\n        this.validate_status2 = 'error';\n        return false;\n      }\n\n      this.departResolve().then(function () {\n        if (_this3.isMultiTenant) {\n          _this3.$store.dispatch('saveTenant', _this3.tenant_id);\n\n          _this3.$emit('success');\n        } else {\n          _this3.$emit('success');\n        }\n      }).catch(function () {\n        console.log('登录选择出问题');\n      });\n    },\n    handleTenantChange: function handleTenantChange(e) {\n      this.validate_status1 = '';\n      this.tenant_id = e;\n    },\n    handleDepartChange: function handleDepartChange(e) {\n      this.validate_status2 = '';\n      this.orgCode = e;\n    }\n  }\n};",null]}